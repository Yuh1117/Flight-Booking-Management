{% extends "layouts/base.html" %} {% block content %}
<div class="container mt-5 min-vh-100">
    <h3>{{flight.route.depart_airport}} â†’ {{flight.route.arrive_airport}}</h2>
    <div class="row">
        <div class="col-md-7">
            <div class="my-3">
                <h5><i class="fa-solid fa-fingerprint me-1"></i>Flight ID: {{flight.id}}</h5>
                <h5 class=""><i class="fa-solid fa-plane-departure me-1"></i>Departs on: {{flight.depart_time}}</h5>
                <h5 class=""><i class="fa-solid fa-plane-arrival me-1"></i>Arrives on: {{flight.arrive_time}}</h5>
                <h5 class=""><i class="fa-solid fa-clock me-1"></i>Total duration: {{(flight.arrive_time - flight.depart_time)}}</h5>
            </div>
            <hr>
            <div class="" style="width: fit-content;">
                <div class="d-flex flex-row align-items-center">
                    <i class="fa-solid fa-plane-departure me-3 fs-4"></i>
                    <div class="">
                        <div>{{flight.route.depart_airport}}</div>
                        <div>Depart: {{flight.depart_time.strftime('%d/%m/%Y - %H:%M')}}</div>
                    </div>
                </div>
                {% set previous_departure_time = [flight.depart_time] %}
                {% for stop in flight.intermediate_airports|sort(attribute='order') %}
                    <div class="d-flex justify-content-center" style="line-height: 3;;">
                        <div class="vr me-3"></div>
                        <div><i class="fa-solid fa-stopwatch me-1"></i>Duration: {{stop.arrival_time - previous_departure_time[0]}}</div>
                    </div>
                    <div class="d-flex flex-row align-items-center">
                        <i class="fa-solid fa-flag me-3 fs-4"></i>
                        <div class="">
                            <div>{{stop.airport}}</div>
                            <div><i class="fa-solid fa-plane-arrival me-1"></i>Arrive: {{stop.arrival_time.strftime('%d/%m/%Y - %H:%M')}}</div>
                            <div><i class="fa-solid fa-pause me-3"></i>Stop for: {{stop.departure_time - stop.arrival_time}}</div>
                            <div><i class="fa-solid fa-plane-departure me-1"></i>Depart: {{stop.departure_time.strftime('%d/%m/%Y - %H:%M')}}</div>
                        </div>
                    </div>
                    {% if previous_departure_time.pop(0) %} {% endif %}
                    {% if previous_departure_time.append(stop.departure_time) %} {% endif %}
                {% endfor %}
                <div class="d-flex justify-content-center" style="line-height: 3;;">
                    <div class="vr me-3"></div>
                    <div><i class="fa-solid fa-stopwatch me-1"></i>Duration: {{flight.arrive_time - previous_departure_time[0]}}</div>
                </div>
                <div class="d-flex flex-row align-items-center">
                    <i class="fa-solid fa-plane-arrival me-3 fs-4"></i>
                    <div class="">
                        <div>{{flight.route.arrive_airport}}</div>
                        <div>Arrive: {{flight.arrive_time.strftime('%d/%m/%Y - %H:%M')}}</div>
                    </div>
                </div>
            </div>
        </div>
        <!--  -->
        <!--  -->
        <!--  -->
        <div class="col-md-5 d-flex mb-3 mb-md-0 mt-3 flex-wrap align-content-start">
            <!-- color for seat classes -->
            {% set colors = ['white', '#e0a623', '#223a60', '#C96868', '#118B50', '#FF7F3E'] %}
            <!-- users role -->
            {% set role = current_user.role.__str__() %} 
            <!--  -->
            {% set remain_time_to_depart = (flight.depart_time - search_time).total_seconds()/60 %}
            <!-- If the the flight has departed -->
            {% if remain_time_to_depart <= 0 %}
                <div class="d-flex flex-column justify-content-center w-100">
                    <div class="text-center">
                        <i class="fa-regular fa-paper-plane"></i>
                        <p class="text-muted">This flight has departed</p>
                    </div>
                </div>
            <!-- If the staff cant even book -->
            {% elif remain_time_to_depart < staff_min_booking_time%}
                <div class="d-flex flex-column justify-content-center w-100">
                    <div class="text-center">
                        <i class="fa-regular fa-circle-xmark"></i>
                        <p class="text-muted">
                        This flight doesn't allow to book anymore!
                        </p>
                    </div>
                </div>
            <!-- If the user is a customer -->
            {% elif (not role or role == 'User') and remain_time_to_depart < customer_min_booking_time %} 
                <div class="d-flex flex-column justify-content-center w-100">
                    <div class="text-center">
                        <i class="fa-solid fa-person-running"></i>
                        <p class="text-muted">Please go to the closest store to book!</p>
                    </div>
                </div>
            <!--  -->
            {% else %}
                {% for id, class in flight.get_seatclasses_and_info().items() %}
                {% if class['remaining'] > 0 %}
                    <a href="#" 
                    class="flex-grow-1 d-flex flex-column align-items-center text-white text-decoration-none p-1" 
                    style="background-color: {{colors[id]}}; height: fit-content;"
                    >
                        <div class="mb-2">{{class['class_name']}}</div>
                        <div class="mb-2">{{class['price']}} {{class['currency']}}</div>
                        <div>Remaining: {{class['remaining']}}</div>
                    </a>
                {% else %}
                    <div class="flex-grow-1 d-block text-center bg-secondary">
                        <div>{{class['class_name']}}</div>
                        <div>Full</div>
                    </div>
                {% endif %}
                {% endfor %}
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}